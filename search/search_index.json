{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Overview","text":"<p>GRAVIS is a web-based open-source visualization and annotation tool designed for use with large, four-dimensional DICOM volumes. It was designed to display GRASP datasets reconstructed at high time resolutions without undue latency or processing delays. </p>"},{"location":"#why-use-gravis","title":"Why use GRAVIS?","text":"<p>GRAVIS is designed for a small team that wants to view and annotate 4D GRASP datasets that are too bulky for their existing software tools. It may also be a useful starting point for development for related use-cases. </p> <p>It currently does not implement a standard DICOM receiver. It can receive datasets from with both YarraServer and mercure using their respective SFTP transfer functionality. The former means that reconstruction outputs can flow from YarraServer directly to GRAVIS for viewing. </p> <p>Alternatively, GRAVIS users can load datasets in on an ad-hoc basis if the files are sufficiently organized and already available on the server itself. At the moment, receiving DICOMs via the DICOM protocol relies on setting up and configuring mercure. </p>"},{"location":"#features","title":"Features","text":"<ul> <li>Navigate 4D dicom volumes in space and time without loading the entire dataset at once</li> <li>Annotate volumes with points and elliptical regions of interest</li> <li>Calculate summary statistics and time curves </li> <li>Multiple readers can collaborate on annotating a set of studies</li> <li>Store and transmit findings as DICOM Secondary Capture images</li> <li>Web-based viewer</li> </ul>"},{"location":"#current-limitations","title":"Current limitations","text":"<ul> <li>No support for standard DICOM transfers</li> <li>No fine-grained permissions or assigning studies to projects. Designed with small groups in mind.</li> <li>Not a fully-featured web imaging platform; you probably want OHIF for that.</li> <li>2D regions of interest only, no freehand / polygonal ROIs.</li> <li>Regions of interest are limited to axial/sagittal/coronal planes</li> <li>Pre-processing pipelines are not configurable without making changes in the code. The code is designed to be fairly modular and easy to extend or modify, but it still requires accessing the backend to  implement your own pipeline.</li> <li>Does not support non-isotropic images(?)</li> </ul>"},{"location":"#workflow","title":"Workflow","text":"<p>GRAVIS uses a batch processing data flow. For each dataset received, it begins a processing pipeline to prepare the volume for display. Received volumes are stored and made available to users as a list of studies. </p> <p>Users can also initiate loading a case on an ad-hoc basis from files already stored on the server. This can enable simpler processing of cases that are available on, for example, network attached storage, without passing through a DICOM transfer first. </p>"},{"location":"install/","title":"Installation","text":""},{"location":"install/#quick-start","title":"Quick start","text":"<p>For demo and testing purposes, GRAVIS is easy to run under a virtual machine using Vagrant. </p> <p>Check out the GRAVIS repository as normal, e.g.</p> <pre><code>git clone https://github.com/gravis-imaging/gravis.git\n</code></pre> <p>Create the new virtual machine and start GRAVIS by running <code>vagrant up</code> in the repository directory. </p> <p>Once running, GRAVIS will be made available at <code>https://localhost:3333</code> on the host machine. You will likely have to click through a security warning, because the installation generates a self-signed certificate to serve GRAVIS. </p> <p>Note</p> <p>Cornerstone3D requires \"Cross Origin Isolation\" as it relies on <code>SharedArrayBuffers</code>; this is all much easier to set up if GRAVIS always runs under HTTPS</p>"},{"location":"install/#loading-a-test-case","title":"Loading a test case","text":"<p>You can load a test case from the host machine. Create a folder in the same directory as the <code>Vagrantfile</code> called <code>cases</code>. Copy your folder of dicoms into <code>./cases</code>, so the paths look something like <code>./cases/case01/series001.slice001.dcm</code>. </p> <p>Navigate to <code>https://localhost:3333/filebrowser/</code> and navigate through <code>vagrant/</code> -&gt; <code>cases/</code> to list the cases available. Select your case and then <code>Import Folder</code> to begin the import process.</p>"},{"location":"install/#server-installation","title":"Server installation","text":""},{"location":"install/#requirements","title":"Requirements","text":"<p>The installer is tested on Ubuntu 22.04. We expect it should mostly work on similar Linux distributions, though some manual intervention will likely be required. Requirements include python 3.10, postgresql, nginx, and redis. It is developed and tested on postgresql 12, nginx 1.18, and redis 5.0.</p>"},{"location":"install/#installation_1","title":"Installation","text":"<p>Having cloned the repository, installation is a matter of running </p> <pre><code>sudo ./install.sh\n</code></pre>"},{"location":"install/#initial-configuration","title":"Initial configuration","text":"<p>To create the initial administrator account, run the following:</p> <pre><code>sudo su gravis \ncd /opt/gravis\nsource venv/bin/activate\napp/manage.py createsuperuser\n</code></pre> <p>Additionally, you will need to set the hostname that you will be accessing your server with. Add the line <code>PROD_HOST=&lt;hostname&gt;</code> to <code>local.env</code>, eg:</p> <pre><code>echo \"\\nPROD_HOST=host.example.com\" &gt;&gt; /opt/gravis/app/local.env\n</code></pre>"},{"location":"install/#enable-local-import","title":"Enable local import","text":"<p>To enable importing cases from files available on the server, update <code>/opt/gravis/app/settings.py</code>. Find <code>BROWSER_BASE_DIRS</code> to enable browsing and importing from paths, e.g.:</p> <pre><code>BROWSER_BASE_DIRS = [{'name': 'archive1', 'location': '/media/archive1'},\n                     {'name': 'archive2', 'location': '/home/gravis/archive2'}]\n</code></pre> <p>The file browser does not require any particular folder structure other than every DICOM for a particular dataset should be contained in the same folder, with no subfolders. </p>"},{"location":"usage/case-browser/","title":"Case browser","text":"<p>Browse, search, and monitor GRAVIS cases. </p> <p></p> Tool Description Open case Unlock case Reprocess case Delete case Show case details Tool Description Tag case Refresh table Clear sorting Upload case"},{"location":"usage/case-browser/#managing-cases","title":"Managing cases","text":"<p>Cases can have several statuses. </p> Status Description Processing Case is still processing Ready Ready for viewing Viewing Currently being viewed Complete Marked complete Delete Marked for deletion Error Error while processing <pre><code>stateDiagram\n    Processing --&gt; Ready : complete\n    Processing --&gt; Error : error\n    Ready --&gt; Viewing : opened\n    Viewing --&gt; Complete : closed\n    Viewing --&gt; Ready : closed\n    Complete --&gt; Ready\n    Complete --&gt; Viewing</code></pre> <p>Processes first appear as \"Processing.\" While processing, they can't be viewed other than by staff. If the processing fails, they are marked as \"Error,\" and again are only viewable by staff accounts.</p> <p>If a case is read-only or not in the \"Viewing\" state, this is displayed in the Viewer as one or more tags in the top bar:</p> <p></p>"},{"location":"usage/case-browser/#opening-closing-and-locking-cases","title":"Opening, closing, and locking cases","text":"<p>Opening a \"Ready\" case updates the case to \"Viewing.\" It also sets you as the case's current viewer. While you are viewing a case, other users can view but not edit it. The case will stay open until the user manually closes the case via the  Close button on the top bar. This will open a prompt to either reset the case back to Ready, or move it to Completed. Completed cases are read-only.</p>"},{"location":"usage/case-browser/#reopening-completed-cases","title":"Reopening completed cases","text":"<p>Users can reopen their own completed cases using the  unlock button on the Case Browser. Staff may reopen any case, even cases that they are not the current viewer for. </p>"},{"location":"usage/case-types/","title":"Case types","text":"<p>GRAVIS supports two case types currently. They each have different processing pipelines and slightly different viewer UIs. </p>"},{"location":"usage/case-types/#grasp-mra","title":"GRASP MRA","text":"<p>GRASP MRA cases have a Maximum Intensity Projection (displayed in the lower left), and a 4D subtraction volume (accessible by switching the dropdown from ORI to SUB). </p> <p></p>"},{"location":"usage/case-types/#grasp-onco","title":"GRASP Onco","text":"<p>GRASP Onco cases generate a series of heatmaps, displayed in the lower left, and selected by switching the lefthand dropdown. The display next to the heatmap viewport shows the average value of each heatmap for each annotation.</p> AUC Area under the curve NORM_WIN Normalized wash-in NORM_WOUT Normalised wash-out PEAK Peak value WIN Wash in WOUT Wash out <p></p>"},{"location":"usage/case-types/#series-viewer","title":"Series Viewer","text":"<p>The Series Viewer can display GRASP volumes without creating any additional series. </p>"},{"location":"usage/importing-cases/","title":"Importing cases","text":"<p>The web filebrowser allows you to import cases that are already available on the server. It supports cases that are stored in individual folders, e.g.: </p> <pre><code>.\n\u251c\u2500\u2500 case_1/\n\u2502   \u251c\u2500\u2500 reco.000.000.dcm\n\u2502   \u251c\u2500\u2500 reco.000.001.dcm\n|   ...\n\u2502   \u2514\u2500\u2500 reco.038.175.dcm\n\u251c\u2500\u2500 case_2/\n\u251c\u2500\u2500 case_3/\n\u2514\u2500\u2500 case_4/\n</code></pre> <p>The \"import folder\" button will become available on folders that have no subfolders. </p> <p></p> <p></p> <p></p> <p>GRAVIS will fill in the patient name, mrn, and accession number from the DICOMs if it can find them. You must select which processing type to use for the case. </p> <p></p>"},{"location":"usage/viewer/","title":"Viewer","text":"Exam switcher Time scroll Aux switch"},{"location":"usage/viewer/#keyboard-controls","title":"Keyboard controls","text":""},{"location":"usage/viewer/#viewports","title":"Viewports","text":"Action Shortcut Scrolling Mouse wheel Windowing CTRL + left click/drag Panning ALT + left click/drag Zooming ALT + right click/drag Centering SHIFT + left click/drag Move ROI SHIFT + left click/drag Fullscreen Double click"},{"location":"usage/viewer/#other","title":"Other","text":"Action Shortcut Time left / right keys Switch case CTRL + left / right keys"},{"location":"usage/viewer/#exam-switcher","title":"Exam switcher","text":"<p>This allows switching between exams of the same patient. The  and  buttons switch to the previous and next exam, sorted by time. The center button lets you jump to a particular exam.</p>"},{"location":"usage/viewer/#time-scroll","title":"Time scroll","text":"<p>Select the timepoint to display. While scrolling, a preview of the current viewports will be displayed. When you let go, the full volume will begin to load in. While loading, the tool is disabled.</p>"},{"location":"usage/viewer/#aux-switch","title":"Aux switch","text":"<p>This dropdown behavior depends on the type of case you're viewing. It can either switch to an alternate volume to display in the main three viewports (eg, a subtraction volume), or it can pick a volume to display in the auxiliary viewport on the bottom left (eg a heatmap). </p>"},{"location":"usage/viewer/#toolbar","title":"Toolbar","text":"Tool Description Extras Reset viewers Toggle free MPR rotation Add elliptical ROI Add probe annotation Select annotation Rename annotation Tool Description Duplicate annotation Flip annotation Delete annotation Save session Load session Reset view Create Finding"},{"location":"usage/viewer/#extras","title":"Extras","text":"<p>This dropdown menu contains a handful of extra tools. They are ordinarily only accessible to staff.</p>"},{"location":"usage/viewer/#rotate","title":"Rotate","text":"<p>These will rotate a case in the Axial plane in place by 90 degrees. This can be used to fix cases that were reconstructed with the wrong orientation.</p>"},{"location":"usage/viewer/#reprocess","title":"Reprocess","text":"<p>Duplicates this case and initiates processing on the new case. This can be used to complete processing on a case that needed to be rotated.</p>"},{"location":"usage/viewer/#reset-viewers","title":"Reset viewers","text":"<p>Reset the viewers back to the center of the volume.</p>"},{"location":"usage/viewer/#toggle-free-mpr-rotation","title":"Toggle free MPR rotation","text":"<p>Clicking on this unlocks the crosshairs to enable free rotation of the volume. Click again to disable rotation and return to in-plane views. While this is turned on, several tools are disabled:</p> <ul> <li>Timepoint slider</li> <li>Annotation adding</li> </ul>"},{"location":"usage/viewer/#add-elliptical-roi-add-probe-annotation","title":"Add elliptical ROI,  Add probe annotation","text":"<p>These both toggle annotation tools. When either is turned on, click (and with ellipses, drag) to create new annotations. </p>"},{"location":"usage/viewer/#find-annotation","title":"Find annotation Load session","text":"<p>This button displays a list of annotations. Click on an annotation to select and scroll a viewport to display it.</p> <p></p> <p>This opens a menu to either switch to a different session, or create a new one. Each session has its own set of annotations on a particular case.</p>"},{"location":"usage/viewer/#rename-annotation","title":"Rename annotation","text":"<p>Give the selected annotation a more descriptive name. </p>"},{"location":"usage/viewer/#duplicate-annotation","title":"Duplicate annotation","text":"<p>Duplicates the selected annotation in-place. Drag the new annotation to move it to a new location.</p>"},{"location":"usage/viewer/#flip-annotation","title":"Flip annotation","text":"<p>Flips the annotation across the sagittal plane. </p>"},{"location":"usage/viewer/#delete-annotation","title":"Delete annotation","text":"<p>Deletes an annotation.</p>"},{"location":"usage/viewer/#save-session","title":"Save session","text":"<p>Saves the current annotations.</p>"},{"location":"usage/viewer/#reset-view","title":"Reset view","text":"<p>Resets the pan and zoom on the viewport</p>"},{"location":"usage/viewer/#create-finding","title":"Create Finding","text":"<p>Take a screenshot of the viewport and store as a finding</p>"},{"location":"usage/viewer/#findings","title":"Findings","text":"<p>Findings are displayed along the right hand side. Click on a finding to open a full-page viewer. </p>"},{"location":"usage/viewer/#locate-finding","title":"Locate finding","text":"<p>Moves the relevant viewport to the same slice as the finding.</p>"},{"location":"usage/viewer/#edit-finding","title":"Edit finding","text":"<p>Add a description to the finding.</p>"},{"location":"usage/viewer/#delete-finding","title":"Delete finding","text":"<p>Delete the finding permanently.</p>"},{"location":"usage/viewer/#send","title":"Send","text":"<p>Send the finding as a DICOM Secondary Capture to the configured destination server</p>"},{"location":"usage/viewer/#charts","title":"Charts","text":"<p> The chart graphs intensity or average intensity over time. The vertical line indicates the current time point displayed in the volume viewports. Using the upper-right dropdown box, you can switch between displaying the median, mean, or ptp (the difference between the brightest and darkest pixel) for ROIs. The other dropdown allows \"zeroed\" or \"normalized\" display: </p> <ul> <li>zeroed: For each annotation, subtract the value at the first timepoint from the rest of the values. This shifts all of the traces up or down to start at 0.</li> <li>normalized: Rescale each trace vertically so its lowest value is 0 and highest value is 1.</li> </ul>"},{"location":"usage/viewer/#download-csv-downloads-a-csv-file-containing-the-data-displayed","title":"Download CSV: Downloads a CSV file containing the data displayed.","text":""},{"location":"usage/viewer/#create-finding-create-a-finding-from-this-chart","title":"Create Finding: Create a finding from this chart.","text":""},{"location":"usage/submitting-cases/from-yarra/","title":"From YarraServer","text":"<p>To transfer cases from a YarraServer, configure a mode to use the <code>SFTPTransfer</code> module. </p> <p>The value of <code>case_type</code> in <code>gravis_settings</code> will determine how the case will be processed.</p> <pre><code>[Transfer]\nBin1=%bd/SFTPTransfer\nArgs1=%mc %td %rit\n\n[sftp_transfer]\nTargetHost=&lt;gravis server hostname&gt;\nTargetUser=gravis\nTargetPath=/opt/gravis/data/incoming\n\n[gravis_settings]\ncase_type=&lt;GRASP Onco or GRASP MRA&gt;\n</code></pre>"}]}